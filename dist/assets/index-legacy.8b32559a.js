!function(){function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}System.register(["./vendor-legacy.64d173cf.js","./index-legacy.49186ad3.js","./index-legacy.d98320d2.js"],(function(n){"use strict";var t,o,i,s,a,r,c,d,u,l,h,m,p,w,f,v,g,L,k,b,y,E,U;return{setters:[function(e){t=e.R,o=e.x,i=e.w,s=e.F,a=e.G},function(e){r=e.aX,c=e.c2,d=e.c3,u=e.al,l=e.c4,h=e.bZ,m=e.N,p=e.aS,w=e.y,f=e.ao,v=e.$,g=e.c5},function(e){L=e.i,k=e.e,b=e.a,y=e.B,E=e.c,U=e.W}],execute:function(){function S(e){return async(n,t)=>{const o=r(t()),i=c(t(),o.id),s=i.automaticTimezone!==e;if(i.useAutomaticTimezone&&s){const s={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:i.manualTimezone},a={...o,timezone:s};d(a)(n,t)}return{}}}const z=u.dispatch,B=u.getState;class T extends t.PureComponent{constructor(n){super(n),e(this,"onDesktopMessageListener",(e=>{const{origin:n,data:{type:t,message:o={}}={}}=e;if(this.props.currentUser&&n===window.location.origin)switch(t){case"register-desktop":{const{version:e}=o;window.desktop||(window.desktop={}),window.desktop.version=i.valid(i.coerce(e));break}case"user-activity-update":{const{userIsActive:e,manual:n}=o;!0!==e&&!1!==e||U.userUpdateActiveStatus(e,n);break}case"notification-clicked":{const{channel:e,teamId:n}=o;window.focus(),this.props.actions.getChannelURLAction(e,n);break}}})),e(this,"handleBackSpace",(e=>{8!==e.which||["input","textarea"].includes(e.target.tagName.toLowerCase())||e.preventDefault()})),e(this,"handleBeforeUnload",(()=>{window.removeEventListener("beforeunload",this.handleBeforeUnload),document.cookie.indexOf(`${m.COOKIE.SESSION_USER}=`)>-1&&p("",this.props.currentChannelId||"")(z,B),E()}));const t=document.getElementById("u3-chatting");t&&(t.className+=" channel-view")}isValidState(){return null!=this.props.currentUser}componentDidMount(){const{currentUser:e,enableTimezone:n,actions:t,location:o}=this.props;L(),n&&t.autoUpdateTimezone(l()),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),document.hasFocus()||k(!1),window.addEventListener("message",this.onDesktopMessageListener),window.postMessage({type:"webapp-ready"},window.location.origin),e||b("/error?type=no-auth&redirect_to="+encodeURIComponent(o.pathname),!0,!1),window.addEventListener("keydown",this.handleBackSpace),this.isValidState()&&y.signalLogin()}componentWillUnmount(){E(),window.removeEventListener("keydown",this.handleBackSpace),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener),window.removeEventListener("message",this.onDesktopMessageListener)}render(){return this.isValidState()?this.props.children:o(h,{message:"Xác thực tài khoản"})}onFocusListener(){k(!0)}onBlurListener(){k(!1)}}var x=T;const C=(e,n)=>(t,o)=>v.push(g(o(),e,n));n("default",s((function(e){const n=w(e);return{currentUser:r(e),currentChannelId:f(e),enableTimezone:"true"===n.ExperimentalTimezone}}),(function(e){return{actions:a({autoUpdateTimezone:S,getChannelURLAction:C},e)}}))(x))}}}))}();
